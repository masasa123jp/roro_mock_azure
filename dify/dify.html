<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project RORO – AIアシスタント</title>

  <!-- 共有スタイル（色・角丸・ナビ等） -->
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="icon" href="images/favicon.ico" type="image/x-icon" />
  <!--
    本ページの目的：
    - 公式 Dify 画面の埋め込み（iframe / script） と
    - 自作の Dify 風 UI
    を、ブール値で切替表示する。
    ※ デザインは styles.css の設計に準拠。
  -->
  <style>
    /* ページ固有の最小限スタイル（共通スタイルに沿った微調整） */
    main.dify-container { padding: 1rem; padding-bottom: calc(var(--nav-height) + 1rem); }
    .panel { background:#fff; border:1px solid #e5e7eb; border-radius: var(--border-radius); padding: 12px; }
    .section-title { margin: 0 0 8px; font-weight: 700; color: var(--base-color); }
    /* ２エリア（どちらか片方のみ表示） */
    #embed-area, #custom-area { display: none; }
    /* iframe で Dify を埋め込むホスト（共通スタイルの external-chat-container に合わせる） */
    #embed-host.external-chat-container { height: calc(100vh - var(--nav-height) - 220px); }
    #embed-host iframe { width: 100%; height: 100%; border: none; border-radius: var(--border-radius); }
    /* 自作 UI のホスト */
    #custom-host { height: calc(100vh - var(--nav-height) - 220px); background:#fff; border:1px solid #e5e7eb; border-radius: var(--border-radius); overflow: hidden; }
    /* 操作用ボタン */
    .toolbar { display:flex; gap:.5rem; justify-content:flex-end; margin:.5rem 0 0; }
    .toolbar .btn { padding:.5rem .9rem; }
  </style>
</head>
<body class="dify-page">
  <!-- ヘッダー（styles.cssの .app-header 準拠） -->
  <header class="app-header">
    <img src="images/logo_roro.png" alt="ロゴ" class="small-logo" />
    <h2 data-i18n-key="ai_title">AIアシスタント</h2>
    <button id="lang-toggle-btn" class="lang-toggle" title="言語切替">
      <img src="images/switch-language.png" alt="Language" />
    </button>
  </header>

  <main class="dify-container">
    <p data-i18n-key="ai_intro">
      AIアシスタントにペットのイベント情報やおすすめスポットなど、気になることを気軽に質問してみましょう。
    </p>

    <!-- ▼ 公式 Dify 画面（iframe または script バブル） -->
    <section id="embed-area" class="panel">
      <h3 class="section-title">Dify AI Chat</h3>

      <!-- iframe 方式のホスト（styles.css に準拠した外観） -->
      <div id="embed-host" class="external-chat-container">
        <!-- JS がここに iframe を挿入します（script 方式時は空のまま） -->
      </div>

      <!--<div class="note">
        ・script 方式では画面右下に “バブル” が表示されます（config を先に定義 → script 読込が必須）。<br>
        ・iframe 方式も公式で案内されている単純な埋め込み方法です。
      </div>
      <div class="toolbar">
        <button id="open-bubble" class="btn secondary-btn" title="（script方式の時）バブルを開く">バブルを開く</button>
      </div>
      -->
    </section>

    <!-- ▼ 自作 Dify 風 UI（SSE対応。API が無ければデモ応答） -->
    <section id="custom-area" class="panel">
      <h3 class="section-title">オリジナル UI（Dify 風）</h3>
      <div id="custom-host"></div>
      <div class="note">
        ・サーバに <code>/api/chat</code>（Dify の <code>/v1/chat-messages</code> へプロキシ）を用意すると、<br>
        　<code>response_mode: "streaming"</code> で SSE を受信しストリーミング描画します。
      </div>
    </section>
	<!--
    <div class="toolbar">
      <button id="toggle-btn" class="btn primary-btn">表示切替（公式 ⇄ 自作）</button>
    </div>
    -->
  </main>

  <!-- ボトムナビ（共通デザイン） -->
  <nav class="bottom-nav">
    <a href="map.html" class="nav-item"><img src="images/icon_map.png" alt="Map" /><span data-i18n-key="nav_map">マップ</span></a>
    <a href="dify.html" class="nav-item active"><img src="images/icon_ai.png" alt="AI" /><span data-i18n-key="nav_ai">AI</span></a>
    <a href="favorites.html" class="nav-item"><img src="images/icon_favorite.png" alt="お気に入り" /><span data-i18n-key="nav_favorites">お気に入り</span></a>
    <a href="magazine.html" class="nav-item"><img src="images/icon_magazine.png" alt="雑誌" /><span data-i18n-key="nav_magazine">雑誌</span></a>
    <a href="profile.html" class="nav-item"><img src="images/icon_profile.png" alt="マイページ" /><span data-i18n-key="nav_profile">マイページ</span></a>
  </nav>

  <!-- 言語・共通初期化 -->
  <script src="js/lang.js"></script>

  <!-- 表示切替とマウント処理（下記モジュール） -->
  <script type="module" src="js/dify-switch.js"></script>
</body>
</html>
