<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project RORO – AIアシスタント</title>
  <style>
    :root {
      --bg: #f8fafc; --card:#fff; --border:#e5e7eb; --brand:#1e40af;
      --radius: 12px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#111827;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    header{position:sticky;top:0;background:var(--card);border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;padding:12px 16px}
    header h1{font-size:16px;margin:0}
    header .spacer{flex:1}
    header button{border:1px solid var(--brand);background:var(--brand);color:#fff;border-radius:8px;padding:8px 12px;cursor:pointer}
    header button.secondary{background:#fff;color:var(--brand)}
    main{max-width:1100px;margin:0 auto;padding:16px}
    .panel{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:12px}
    .section-title{margin:0 0 8px 0;font-weight:700}
    /* 2エリア（どちらか一方だけ表示） */
    #embed-area, #custom-area { display:none; }
    #embed-host{min-height:70vh;border-radius:var(--radius);overflow:hidden;border:1px solid var(--border)}
    #embed-host iframe{width:100%;height:70vh;border:0}
    /* 自作チャットの箱（内部UIは custom-chat-ui.js が注入） */
    #custom-host{min-height:70vh;border-radius:var(--radius);border:1px solid var(--border);overflow:hidden;background:#fff}
    /* タブバー（簡易） */
    nav.bottom{position:sticky;bottom:0;display:flex;gap:8px;background:var(--card);border-top:1px solid var(--border);padding:8px;justify-content:space-around}
    nav.bottom a{color:#475569;text-decoration:none;padding:6px 8px;border-radius:8px}
    nav.bottom a.active{color:var(--brand);font-weight:700}
    /* 情報ボックス */
    .note{font-size:13px;color:#374151;line-height:1.7}
    .note code{background:#eef2ff;padding:0 4px;border-radius:4px}
  </style>
</head>
<body>
  <header>
    <h1>AIアシスタント</h1>
    <div class="spacer"></div>
    <!-- 表示切替ボタン：押すたび true/false をトグル -->
    <button id="toggle-btn" title="Dify埋め込み / 自作UI 切替">切替</button>
    <button id="open-bubble" class="secondary" title="（script方式のとき）バブルを開く">バブルを開く</button>
  </header>

  <main>
    <!-- ▼ Dify公式画面（iframe or script） -->
    <section id="embed-area" class="panel">
      <h2 class="section-title">Dify 公式画面</h2>
      <div id="embed-host">
        <!-- method='iframe' の場合にここへ iframe を挿入します -->
      </div>
      <p class="note">
        * script 方式にすると、右下に “バブル” が出ます（この枠とは独立オーバーレイ）。<br>
        * script 方式は <code>window.difyChatbotConfig</code> を <strong>先に定義→script 読込</strong> が必須です。:contentReference[oaicite:6]{index=6}<br>
        * iframe 方式／script 方式はどちらも公式に記載があります。:contentReference[oaicite:7]{index=7}
      </p>
    </section>

    <!-- ▼ 自作の Dify 風チャットUI（SSE対応） -->
    <section id="custom-area" class="panel">
      <h2 class="section-title">オリジナル UI（Dify 風）</h2>
      <div id="custom-host"></div>
      <p class="note">
        * この UI は、既存の <code>ai_assistant_chat_v2.html</code> の設計をモジュール化して再利用しています。:contentReference[oaicite:8]{index=8}<br>
        * バックエンドの <code>/api/chat</code> があれば SSE でストリーミング表示、なければデモ応答にフォールバックします。:contentReference[oaicite:9]{index=9} :contentReference[oaicite:10]{index=10}
      </p>
    </section>
  </main>

  <nav class="bottom">
    <a href="#" class="active">AI</a>
    <a href="#">マップ</a>
    <a href="#">お気に入り</a>
    <a href="#">マイページ</a>
  </nav>

  <!-- 切替とマウントの本体 -->
  <script type="module" src="./dify-switch.js"></script>
</body>
</html>
